name: PR Build

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

permissions: write-all

jobs:
  pr-build-on-dev-central:
    name: Build PR using Dev Central
    runs-on: ubuntu-latest
    steps:
      - uses: wso2/choreo-apim-mediation-policies/.github/workflows/env-setup.yml@main
        
      - name: Build Policies
        env:
          BALLERINA_CENTRAL_ACCESS_TOKEN: ${{ secrets.BAL_DEV_CENTRAL_TOKEN }}
          BALLERINA_DEV_CENTRAL: true
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python build.py build

  pr-build-on-stage-central:
    name: Build PR using Stage Central
    runs-on: ubuntu-latest
    steps:
      - uses: wso2/choreo-apim-mediation-policies/.github/workflows/env-setup.yml@main
        
      - name: Build Policies
        env:
          BALLERINA_CENTRAL_ACCESS_TOKEN: ${{ secrets.BAL_STAGE_CENTRAL_TOKEN }}
          BALLERINA_STAGE_CENTRAL: true
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python build.py build
